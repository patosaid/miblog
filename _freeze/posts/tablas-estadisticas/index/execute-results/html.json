{
  "hash": "ca83c382c4596317c8cf7bd5aad3c89d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mostrar tablas estadisticas con kableExtra\"\nlang: es\nauthor: \"Patricio Said\"\ndate: \"2019-09-25\"\ncategories: [\"r\" , \"recursos\", \"kableExtra\" ]\n---\n\n\n\nEn cualquier trabajo de investigación que involucre una muestra o conjunto de datos es importante mostrar un cuadro resumen que contenga estadísticas descriptivas del conjunto, de esta manera se puede comunicar de forma clara la dimensión de los datos del estudio.\n\nCon solo dos herramientas la construcción de tablas resúmnes resulta muy facil y sencilla. Las funciones de `dplyr` permiten calcular diferentes estadísticas según grupos. Una vez terminada la tabla el paquete `kableExtra` transforma facimente la información de la tabla a formato HTML o Latex (para visualizar en PDF).\n\n## Los datos a usar\n\n\n\n\n\n\n\nPara este ejemplo utilizo los datos `vuelos` que están dentro del paquete `datos`. `vuelos` es la traducción al español del conjunto `nycflights13::flights`. Este conjunto contiene los datos de los vuelos que despegaron de Nueva York durante el 2013.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(datos)\nlibrary(tidyverse)\nvuelos\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 336,776 × 19\n    anio   mes   dia horario_salida salida_programada atraso_salida\n   <int> <int> <int>          <int>             <int>         <dbl>\n 1  2013     1     1            517               515             2\n 2  2013     1     1            533               529             4\n 3  2013     1     1            542               540             2\n 4  2013     1     1            544               545            -1\n 5  2013     1     1            554               600            -6\n 6  2013     1     1            554               558            -4\n 7  2013     1     1            555               600            -5\n 8  2013     1     1            557               600            -3\n 9  2013     1     1            557               600            -3\n10  2013     1     1            558               600            -2\n# ℹ 336,766 more rows\n# ℹ 13 more variables: horario_llegada <int>, llegada_programada <int>,\n#   atraso_llegada <dbl>, aerolinea <chr>, vuelo <int>, codigo_cola <chr>,\n#   origen <chr>, destino <chr>, tiempo_vuelo <dbl>, distancia <dbl>,\n#   hora <dbl>, minuto <dbl>, fecha_hora <dttm>\n```\n\n\n:::\n:::\n\n\n\nLos datos vienen en formato tibble. De manera de ejemplo y poder probar las agrupaciones de columnas y filas al momento de mostrar la tabla voy a filtrar el conjunto de datos en un rango de tres meses (septiembre a noviembre) y trabajar con los datos de las 3 aerolíneas con más vuelos.\n\n## Preparando los datos\n\n`mayores_aerolineas` guarda las 3 aerolineas con mas vuelos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmayores_aerolineas <- vuelos %>% select(mes, aerolinea) %>% \n  filter(mes %in% (9:11)) %>% \n  group_by( aerolinea) %>% \n    summarise(n = n()) %>% \n  arrange(desc(n)) %>% \n  slice(1:3) %>% \n  ungroup()\n\n# Busca los nombres  \naerolineas %>% \n  filter(aerolinea %in% mayores_aerolineas$aerolinea)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  aerolinea nombre                  \n  <chr>     <chr>                   \n1 B6        JetBlue Airways         \n2 EV        ExpressJet Airlines Inc.\n3 UA        United Air Lines Inc.   \n```\n\n\n:::\n:::\n\n\n\nEn `datos` guarda los datos a utilizar para este ejemplo.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos <- vuelos %>% \n  select(mes, aerolinea, atraso_llegada, atraso_salida) %>% \n  filter(atraso_salida > 0 , atraso_llegada > 0) %>% \n  filter(mes >=9, mes <=11) %>% \n  filter(aerolinea %in% mayores_aerolineas$aerolinea) %>% \n  arrange(mes)\ndatos\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8,688 × 4\n     mes aerolinea atraso_llegada atraso_salida\n   <int> <chr>              <dbl>         <dbl>\n 1     9 B6                     3            10\n 2     9 B6                   139           152\n 3     9 EV                     8            11\n 4     9 B6                     9             2\n 5     9 B6                    13            18\n 6     9 B6                    46            57\n 7     9 EV                    61            80\n 8     9 EV                     4            25\n 9     9 UA                    16            50\n10     9 EV                    30            38\n# ℹ 8,678 more rows\n```\n\n\n:::\n:::\n\n\n\nDe manera de hacer un ejemplo práctico, generalmente en los papers que ajustan modelos de predicción suele mostrarse el conjunto de datos separados en \"ajuste\" y \"prueba\". Para esto, el conjunto `datos` se dividió aleatoriamente en proporción 80:20. Luego para cada conjunto se calcularon algunas estadísticas en base a la variable `atraso_llegada`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos <- datos %>%  \n  mutate(conjunto = sample(c(\"train\",\"test\"), nrow(datos), replace = T, prob = c(0.8,0.2)))\n\ndatos_train <- datos %>% select(mes,aerolinea, conjunto, atraso_llegada) %>% \n  filter(conjunto == \"train\") %>% \n  group_by(mes, aerolinea) %>% \n  summarise(n_train = n(), \n            min_llegada_train = min(atraso_llegada),\n            prom_llegada_train = mean(atraso_llegada),\n            max_llegada_train = max(atraso_llegada),\n            sd_llegada_train = sd(atraso_llegada)\n            ) %>% \n  ungroup()\n\ndatos_test <- datos %>% select(mes,aerolinea, conjunto, atraso_llegada) %>% \n  filter(conjunto == \"test\") %>% \n  group_by(mes, aerolinea) %>% \n  summarise(n_test = n(), \n            min_llegada_test = min(atraso_llegada),\n            prom_llegada_test = mean(atraso_llegada),\n            max_llegada_test = max(atraso_llegada),\n            sd_llegada_test = sd(atraso_llegada)\n            ) %>% \n  ungroup()\n```\n:::\n\n\n\nLuego en `resumen` se guardó la información a mostrar en la tabla.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresumen <- left_join(datos_train,datos_test) %>% \n  mutate(mes = case_when(\n                      mes == 9 ~ \"Septiembre\",\n                      mes ==10 ~ \"Octubre\",\n                      mes ==11 ~ \"Noviembre\")) %>% \n  left_join(aerolineas) %>% \n  select(mes, nombre, everything(), - (aerolinea))\n```\n:::\n\n\n\nPara mostrar la tabla en formato se utilizó la función `kable()` del paquete `kableExtra`. Por defecto el tipo de formato está en HTML. En los nombres de columnas se agregó `<br>` (salto de línea en HTML). Para agrupar filas se podría usar `collapse_rows()` según la variable `mes`.\n\n# Creando tabla\n\n## HTML\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(kableExtra) \nresumen %>% select(-mes) %>% \nkable( format = \"html\", \n       format.args = list(decimal.mark = ',', big.mark = \".\"),\n       col.names = ( c(\"Aerolínea\",\n                       rep(c(\"N\",\"Min.<br>*(minutos)*\",\n                             \"Media<br>*(minutos)*\",\n                             \"Max.<br>*(minutos)*\",\n                             \"D.E<br>*(minutos)*\"),\n                           2))), \n         digits = 1 , escape = F) %>%\n  kable_styling(c(\"striped\"),font_size = 11) %>% \n  add_header_above(header = c(\" \"=1, \n                              \"Conjunto entrenamiento (N=6.973)\" = 5,\n                              \"Conjunto prueba (N=1.715)\" = 5 ) ) %>% \n  pack_rows(\"Septiembre\", 1, 3) %>% \n  pack_rows(\"Octubre\", 4, 6) %>% \n  pack_rows(\"Noviembre\", 7,9) %>% \n   footnote(general = \"D.E: Desviación estandar.\",\n            footnote_as_chunk = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"font-size: 11px; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"5\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Conjunto entrenamiento (N=6.973)</div></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"5\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Conjunto prueba (N=1.715)</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> Aerolínea </th>\n   <th style=\"text-align:right;\"> N </th>\n   <th style=\"text-align:right;\"> Min.<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> Media<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> Max.<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> D.E<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> N </th>\n   <th style=\"text-align:right;\"> Min.<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> Media<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> Max.<br>*(minutos)* </th>\n   <th style=\"text-align:right;\"> D.E<br>*(minutos)* </th>\n  </tr>\n </thead>\n<tbody>\n  <tr grouplength=\"3\"><td colspan=\"11\" style=\"border-bottom: 1px solid;\"><strong>Septiembre</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> JetBlue Airways </td>\n   <td style=\"text-align:right;\"> 594 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 54,3 </td>\n   <td style=\"text-align:right;\"> 396 </td>\n   <td style=\"text-align:right;\"> 64,5 </td>\n   <td style=\"text-align:right;\"> 154 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 40,9 </td>\n   <td style=\"text-align:right;\"> 195 </td>\n   <td style=\"text-align:right;\"> 43,2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> ExpressJet Airlines Inc. </td>\n   <td style=\"text-align:right;\"> 734 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 49,5 </td>\n   <td style=\"text-align:right;\"> 364 </td>\n   <td style=\"text-align:right;\"> 55,9 </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 56,2 </td>\n   <td style=\"text-align:right;\"> 444 </td>\n   <td style=\"text-align:right;\"> 70,1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> United Air Lines Inc. </td>\n   <td style=\"text-align:right;\"> 563 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 51,6 </td>\n   <td style=\"text-align:right;\"> 406 </td>\n   <td style=\"text-align:right;\"> 70,5 </td>\n   <td style=\"text-align:right;\"> 150 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 52,7 </td>\n   <td style=\"text-align:right;\"> 373 </td>\n   <td style=\"text-align:right;\"> 71,3 </td>\n  </tr>\n  <tr grouplength=\"3\"><td colspan=\"11\" style=\"border-bottom: 1px solid;\"><strong>Octubre</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> JetBlue Airways </td>\n   <td style=\"text-align:right;\"> 551 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 36,2 </td>\n   <td style=\"text-align:right;\"> 366 </td>\n   <td style=\"text-align:right;\"> 43,6 </td>\n   <td style=\"text-align:right;\"> 146 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 41,7 </td>\n   <td style=\"text-align:right;\"> 335 </td>\n   <td style=\"text-align:right;\"> 49,2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> ExpressJet Airlines Inc. </td>\n   <td style=\"text-align:right;\"> 1.171 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 51,5 </td>\n   <td style=\"text-align:right;\"> 318 </td>\n   <td style=\"text-align:right;\"> 50,5 </td>\n   <td style=\"text-align:right;\"> 289 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 51,7 </td>\n   <td style=\"text-align:right;\"> 300 </td>\n   <td style=\"text-align:right;\"> 48,4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> United Air Lines Inc. </td>\n   <td style=\"text-align:right;\"> 831 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 35,6 </td>\n   <td style=\"text-align:right;\"> 288 </td>\n   <td style=\"text-align:right;\"> 43,8 </td>\n   <td style=\"text-align:right;\"> 242 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 33,9 </td>\n   <td style=\"text-align:right;\"> 239 </td>\n   <td style=\"text-align:right;\"> 38,7 </td>\n  </tr>\n  <tr grouplength=\"3\"><td colspan=\"11\" style=\"border-bottom: 1px solid;\"><strong>Noviembre</strong></td></tr>\n<tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> JetBlue Airways </td>\n   <td style=\"text-align:right;\"> 622 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 35,9 </td>\n   <td style=\"text-align:right;\"> 299 </td>\n   <td style=\"text-align:right;\"> 37,3 </td>\n   <td style=\"text-align:right;\"> 179 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 39,7 </td>\n   <td style=\"text-align:right;\"> 217 </td>\n   <td style=\"text-align:right;\"> 43,0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> ExpressJet Airlines Inc. </td>\n   <td style=\"text-align:right;\"> 995 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 42,8 </td>\n   <td style=\"text-align:right;\"> 334 </td>\n   <td style=\"text-align:right;\"> 42,7 </td>\n   <td style=\"text-align:right;\"> 244 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 42,0 </td>\n   <td style=\"text-align:right;\"> 389 </td>\n   <td style=\"text-align:right;\"> 44,0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;padding-left: 2em;\" indentlevel=\"1\"> United Air Lines Inc. </td>\n   <td style=\"text-align:right;\"> 830 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 34,8 </td>\n   <td style=\"text-align:right;\"> 346 </td>\n   <td style=\"text-align:right;\"> 46,9 </td>\n   <td style=\"text-align:right;\"> 204 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 38,1 </td>\n   <td style=\"text-align:right;\"> 335 </td>\n   <td style=\"text-align:right;\"> 49,2 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> D.E: Desviación estandar.</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Latex\n\nPara formato Latex se debe especificar en el argumento `formato = \"latex\"`. Algunos argumentos son difentes, como en el caso de los saltos en líneas en los nombres:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresumen %>% select(-mes) %>% \n kable( format.args = list(decimal.mark = ',', big.mark = \".\"),\n        digits = 2, \"latex\", booktabs= T, linesep=\"\", \n        escape = F, \n        caption = \"Resumen estadístico\",\n        col.names = linebreak( c(\"Aerolínea\",\n                       rep(c(\"N\",\"Min.\\n(minutos\",\n                             \"Media\\n(minutos)\",\n                             \"Max.\\n(minutos)\",\n                             \"D.E\\n(minutos)\"),\n                           2)))) %>%\n  kable_styling(latex_options=\"scale_down\") %>% \n  add_header_above(header = c(\" \"=1, \n                              \"Conjunto entrenamiento (N=6.973)\" = 5,\n                              \"Conjunto prueba (N=1.715)\" = 5 ) ) %>% \n  pack_rows(\"Septiembre\", 1, 3) %>% \n  pack_rows(\"Octubre\", 4, 6) %>% \n  pack_rows(\"Noviembre\", 7,9) %>% \n   footnote(symbol = \"D.E: Desviación estandar.\",\n            footnote_as_chunk = F)\n```\n\n::: {.cell-output-display}\n\\begin{table}\n\\centering\n\\caption{\\label{tab:unnamed-chunk-7}Resumen estadístico}\n\\centering\n\\resizebox{\\ifdim\\width>\\linewidth\\linewidth\\else\\width\\fi}{!}{\n\\begin{tabular}[t]{lrrrrrrrrrr}\n\\toprule\n\\multicolumn{1}{c}{ } & \\multicolumn{5}{c}{Conjunto entrenamiento (N=6.973)} & \\multicolumn{5}{c}{Conjunto prueba (N=1.715)} \\\\\n\\cmidrule(l{3pt}r{3pt}){2-6} \\cmidrule(l{3pt}r{3pt}){7-11}\nAerolínea & N & \\makecell[l]{Min.\\\\(minutos} & \\makecell[l]{Media\\\\(minutos)} & \\makecell[l]{Max.\\\\(minutos)} & \\makecell[l]{D.E\\\\(minutos)} & N & \\makecell[l]{Min.\\\\(minutos} & \\makecell[l]{Media\\\\(minutos)} & \\makecell[l]{Max.\\\\(minutos)} & \\makecell[l]{D.E\\\\(minutos)}\\\\\n\\midrule\n\\addlinespace[0.3em]\n\\multicolumn{11}{l}{\\textbf{Septiembre}}\\\\\n\\hspace{1em}JetBlue Airways & 594 & 1 & 54,27 & 396 & 64,52 & 154 & 1 & 40,86 & 195 & 43,24\\\\\n\\hspace{1em}ExpressJet Airlines Inc. & 734 & 1 & 49,52 & 364 & 55,89 & 189 & 1 & 56,22 & 444 & 70,11\\\\\n\\hspace{1em}United Air Lines Inc. & 563 & 1 & 51,63 & 406 & 70,45 & 150 & 1 & 52,67 & 373 & 71,35\\\\\n\\addlinespace[0.3em]\n\\multicolumn{11}{l}{\\textbf{Octubre}}\\\\\n\\hspace{1em}JetBlue Airways & 551 & 1 & 36,15 & 366 & 43,60 & 146 & 1 & 41,73 & 335 & 49,24\\\\\n\\hspace{1em}ExpressJet Airlines Inc. & 1.171 & 1 & 51,49 & 318 & 50,49 & 289 & 1 & 51,66 & 300 & 48,38\\\\\n\\hspace{1em}United Air Lines Inc. & 831 & 1 & 35,55 & 288 & 43,84 & 242 & 1 & 33,92 & 239 & 38,66\\\\\n\\addlinespace[0.3em]\n\\multicolumn{11}{l}{\\textbf{Noviembre}}\\\\\n\\hspace{1em}JetBlue Airways & 622 & 1 & 35,95 & 299 & 37,29 & 179 & 1 & 39,74 & 217 & 43,03\\\\\n\\hspace{1em}ExpressJet Airlines Inc. & 995 & 1 & 42,82 & 334 & 42,73 & 244 & 1 & 42,05 & 389 & 44,00\\\\\n\\hspace{1em}United Air Lines Inc. & 830 & 1 & 34,81 & 346 & 46,86 & 204 & 1 & 38,15 & 335 & 49,20\\\\\n\\bottomrule\n\\multicolumn{11}{l}{\\rule{0pt}{1em}\\textsuperscript{*} D.E: Desviación estandar.}\\\\\n\\end{tabular}}\n\\end{table}\n\n\n:::\n:::\n\n\n\nLa salida sería algo así:\n\n![](latex.PNG){fig-align=\"center\"}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}